@using System.Security.Claims

@{
    var userId = User.FindFirstValue(ClaimTypes.NameIdentifier) ?? "";
    var roleName = User.FindFirstValue(ClaimTypes.Role) ?? "";

    var displayName = await userService.GetDisplayNameAsync(userId);
    var user = await userManager.FindByIdAsync(userId);
    var userAvatar = user?.ImageUrl ?? "/images/avatars/Avatar-1.svg";

    var notificationResult = await notificationService.GetNotificationsAsync(userId, roleName);
    var notifications = (notificationResult.Result ?? []).OrderByDescending(x => x.CreatedAt).ToList();
    var unreadCount = notifications.Count(n => !n.IsRead);
}

<input type="checkbox" id="hamburger-toggle" class="hamburger-checkbox" />
<label for="hamburger-toggle" class="hamburger-icon">
    <span></span>
    <span></span>
</label>

<div class="searchbox">
    <i class="fa-duotone fa-solid fa-magnifying-glass"></i>
    <input type="text" placeholder="Search anything..." />
</div>

<div class="header-actions">

    @* Notification Dropdown *@
    <div class="dropdown-wrapper window" id="notification-dropdown">
        @{
            var notificationsModel = new NotificationDropdownViewModel
            {
                UnreadCount = unreadCount,
                Notifications = notifications.Select(n => new NotificationItemViewModel
                {
                    Id = n.Id,
                    Message = n.Message,
                    Image = n.ImageUrl,
                    CreatedAt = n.CreatedAt,
                    IsRead = n.IsRead
                }).ToList()
            };
        }
        <partial name="Partials/Components/Dropdowns/_NotificationDropdown" model="@notificationsModel" />
    </div>

    @* Profile Dropdown *@
    <div class="dropdown-wrapper window" id="profile-dropdown">
        @{
            var profileModel = new ProfileDropdownViewModel
            {
                UserId = userId,
                DisplayName = displayName,
                AvatarUrl = userAvatar,
                IsDarkMode = false,
                LogoutUrl = Url.Action("Logout", "Auth") ?? "#"
            };
        }
        <partial name="Partials/Components/Dropdowns/_ProfileDropdown" model="@profileModel" />
    </div>
</div>
